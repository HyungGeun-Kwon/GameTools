<UserControl x:Class="GameTools.Client.Wpf.Views.Shared.BusyOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:GameTools.Client.Wpf.Views.Shared"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="200">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <!-- 오버레이: IsActive=true면 표시 -->
    <Grid Background="{Binding OverlayBrush, RelativeSource={RelativeSource AncestorType=UserControl}}"
          Visibility="{Binding IsActive, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}"
          IsHitTestVisible="{Binding BlockInput, RelativeSource={RelativeSource AncestorType=UserControl}}">

        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
            <!-- 스피너 -->
            <Viewbox Width="{Binding Size, RelativeSource={RelativeSource AncestorType=UserControl}}"
                     Height="{Binding Size, RelativeSource={RelativeSource AncestorType=UserControl}}">
                <Grid Width="36" Height="36">
                    <Ellipse Width="36" Height="36"
                             Stroke="{Binding RingBaseBrush, RelativeSource={RelativeSource AncestorType=UserControl}}"
                             StrokeThickness="{Binding Thickness, RelativeSource={RelativeSource AncestorType=UserControl}}"/>

                    <Path Stroke="{Binding RingBrush, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          StrokeThickness="{Binding Thickness, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                          Data="M 18,2 A 16,16 0 0 1 34,18">
                        <Path.RenderTransform>
                            <RotateTransform CenterX="18" CenterY="18"/>
                        </Path.RenderTransform>
                        <Path.Style>
                            <Style TargetType="Path">
                                <Style.Triggers>
                                    <DataTrigger Value="True">
                                        <DataTrigger.Binding>
                                            <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                        </DataTrigger.Binding>
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard x:Name="SpinStoryboard">
                                                <Storyboard RepeatBehavior="Forever">
                                                    <DoubleAnimation
                                                        Storyboard.TargetProperty="(RenderTransform).(RotateTransform.Angle)"
                                                        From="0" To="360" Duration="0:0:1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                        <DataTrigger.ExitActions>
                                            <StopStoryboard BeginStoryboardName="SpinStoryboard"/>
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Path.Style>
                    </Path>
                </Grid>
            </Viewbox>

            <!-- 취소 버튼 -->
            <Button Content="{Binding CancelText, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Command="{Binding CancelCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding CancelCommandParameter, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Margin="0,10,0,0" Padding="12,4"
                    HorizontalAlignment="Center"
                    Background="Transparent" BorderThickness="0"
                    Visibility="{Binding ShowCancel, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </StackPanel>
    </Grid>
</UserControl>